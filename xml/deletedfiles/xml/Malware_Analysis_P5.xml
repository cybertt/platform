<?xml version="1.0"?>
<exercises>
  <exercise>
    <title>Malware Analysis - Windows - Part 5</title>
    <difficulty>3</difficulty>
    <name>Malware_Analysis_P5</name>
    <shortdescription>Analyze Malicious Windows Programs: Lab 14-1</shortdescription>
    <description>In this exercise you will analyze malicious windows programs using native windows commands and a debugger. The malicious application comes from Practical Malware Analysis, Chapter 14. </description>
    <tutorial>&lt;p&gt;Before running the malware, read through Chapter 14 of Practical Malware Analysis. It will help with doing this malware analysis exercise.&lt;/p&gt;&#xD;
&lt;ol&gt;&#xD;
&lt;li&gt;Open up the directory in the share drive 'ShareFiles(S:)\Practical Malware Analysis Labs\BinaryCollection\Chapter14L'.&lt;/li&gt;&#xD;
&lt;li&gt;Select 'Lab14_01.exe' and run it.&amp;nbsp;&lt;/li&gt;&#xD;
&lt;li&gt;Analyze the malware using native windows commands, and the debugger of your choice.&amp;nbsp;&lt;/li&gt;&#xD;
&lt;/ol&gt;</tutorial>
    <question>
      <text>Which networking libraries does the malware use, and what are their advantages?</text>
      <answer>The program contains the URLDownloadToCacheFile function, which uses the COM interface. When malware uses COM interfaces, most of the content of its HTTP requests comes from within Windows itself, and therefore cannot be effectively targeted using network signatures.</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
    <question>
      <text>What source elements are used to construct the networking beacon, and what conditions would cause the beacon to change?</text>
      <answer>The source elements are part of the host&#x2019;s GUID and the username. The GUID is unique for any individual host OS, and the 6-byte portion used in the beacon should be relatively unique. The username will change depending on who is logged in to the system.</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
    <question>
      <text>Why might the information embedded in the networking beacon be of interest to the attacker?</text>
      <answer>The attacker may want to track the specific hosts running the downloader and target specific users.</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
    <question>
      <text>Does the malware use standard Base64 encoding? If not, how is the encoding unusual?</text>
      <answer>The Base64 encoding is not standard since it uses an a instead of an equal sign (=) for its padding.</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
    <question>
      <text>What is the overall purpose of this malware?</text>
      <answer>This malware downloads and executes other code.</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
    <question>
      <text>What elements of the malware&#x2019;s communication may be effectively detected using a network signature?</text>
      <answer>The elements of the malware communication to be targeted include the domain name, the colons and the dash found after Base64 decoding, and the fact that the last character of the Base64 portion of the URI is the single character used for the filename of the PNG file.</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
    <question>
      <text>What mistakes might analysts make in trying to develop a signature for this malware?</text>
      <answer>Defenders may try to target elements other than the URI if they don&#x2019;t realize that the OS determines them. In most cases, the Base64 string ends with an a, which usually makes the filename appear as a.png. However, if the username length is an even multiple of three, both the final character and the filename will depend on the last character in the encoded username. In this case, the filename is unpredictable.</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
    <question>
      <text>What set of signatures would detect this malware (and future variants)?</text>
      <answer>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:"PM14.1.1 Colons and&#xD;
dash"; urilen:&gt;32; content:"GET|20|/"; depth:5; pcre:"/GET\x20\/[A-Z0-9a-z+\/]&#xD;
{3}6[A-Z0-9a-z+\/]{3}6[A-Z0-9a-z+\/]{3}6[A-Z0-9a-z+\/]{3}6[A-Z0-9a-z+\/]{3}6[A&#xD;
-Z0-9a-z+\/]{3}t([A-Z0-9a-z+\/]{4}){1,}\//"; sid:20001411; rev:1;)</answer>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
      <wrong>to do</wrong>
    </question>
  </exercise>
</exercises>
