<?xml version="1.0"?>
<exercises>
  <exercise>
    <title>Malware Analysis - Windows - Part 3</title>
    <difficulty>2</difficulty>
    <category>CND</category>
    <name>Malware_Analysis_P3</name>
    <dependencies>Malware_Analysis_P2</dependencies>
    <shortdescription>Analyze Malicious Windows Programs: Lab 11-1</shortdescription>
    <description>In this exercise you will analyze malicious windows programs using native windows commands and a debugger. The malicious application comes from Practical Malware Analysis, Chapter 11. </description>
    <tutorial>&lt;p&gt;Before running the malware, read through Chapter 7 of Practical Malware Analysis. It will help with doing the malware analysis exercises.&lt;/p&gt;&#xD;
&lt;ol&gt;&#xD;
&lt;li&gt;Using your defense workstation, open up the directory in the share drive 'ShareFiles(S:)\Practical Malware Analysis Labs\BinaryCollection\Chapter11L'.&lt;/li&gt;&#xD;
&lt;li&gt;Select 'Lab11_01.exe' and run it.&amp;nbsp;&lt;/li&gt;&#xD;
&lt;li&gt;Analyze the malware using native windows commands, and the debugger of your choice--OllyDbg, ImmunityDebugger, IDA Pro Free-- in the share drive. I recommend IDA Pr&lt;/li&gt;&#xD;
&lt;/ol&gt;</tutorial>
    <question>
      <text>What does the malware drop to disk?</text>
      <type>multiple</type>
      <answer>The malware extracts and drops the file msgina32.dll onto disk from a resource section named TGAD.</answer>
      <wrong>The malware drops spoolvxx32.dll into %SystemRoot%\System32\</wrong>
      <wrong>The malware doesn't install anything onto disk.</wrong>
      <wrong>The malware drops msutil32.sys onto disk.</wrong>
    </question>
    <question>
      <text>How does the malware achieve persistence?</text>
      <type>multiple</type>
      <answer>Registry location HKLM\SOFTWARE\Micorsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL is added with a value msgina32.dll.</answer>
      <wrong>Registry location HKCU\SOFTWARE\Micorsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL is added with a value msgina32.dll</wrong>
      <wrong>Service is created and has a start type of 0x04.</wrong>
      <wrong>Scheduled Job is created to install msgina32.dll if not already installed.</wrong>
    </question>
    <question>
      <text>How does the malware steal user credentials?</text>
      <type>multiple</type>
      <answer>The malware steals user credentials by performing GINA interception. The msgina32.dll file is able to intercept all user credentials submitted to the system for authentication.</answer>
      <wrong>msgina32.dll is a keylogger that steals user credentials.</wrong>
      <wrong>The malware doesn't actually steal user credentials. A typo in the code prevents the user credentials from being written to a file.</wrong>
      <wrong>msgina32.dll performs privilege escalation and exfils /etc/password and /etc/shadow.</wrong>
    </question>
    <question>
      <text>What does the malware do with stolen credentials?</text>
      <type>multiple</type>
      <answer>The malware logs stolen credentials to %SystemRoot%\System32\msutil32.sys. </answer>
      <wrong>The malware can't do anything with the stolen credentials because of a typo in the code preventing the stolen credentials from being written to a file.</wrong>
      <wrong>The malware logs stolen credentials to %SystemRoot%\System32\msutil32.sys.log.</wrong>
      <wrong>The malware logs stolen credentials to %SystemRoot%\System32\msutil32.sys and sends that file to a remote server.</wrong>
    </question>
    <question>
      <text>How can you use this malware to get user credentials from your test environment?</text>
      <type>multiple</type>
      <answer>Install msgina32.dll and reboot. Then log out and back in to see the user credentials in the log file.</answer>
      <wrong>Install msgina32.dll. User credentials are instantly pulled and logged, so check the log file after installing.</wrong>
      <wrong>Install msgina32.dll. Then log out and back in to see the user credentials in the log file.</wrong>
      <wrong>After installing msgina32.dll, fix the typo in the code to correctly store credentials in the log file. Then log out and back in to check the log file.</wrong>
    </question>
  </exercise>
</exercises>
